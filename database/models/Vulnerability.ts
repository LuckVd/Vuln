export interface Vulnerability {
  id: string;
  name: string;
  source: string;
  riskLevel: 'critical' | 'high' | 'medium' | 'low';
  discoveryTime: string;
  expectedBlockTime: string;
  status: 'pending' | 'processing' | 'approved' | 'unassigned';
  description: string;
  severity: string;
  affectedComponent: string;
  recommendation: string;
  approvalId?: string; // 可选字段，表示关联的审批单
  createdBy?: string;
  createdAt?: string;
  updatedAt?: string;
}

export interface CreateVulnerabilityInput {
  name: string;
  source: string;
  riskLevel: string;
  discoveryTime: string;
  expectedBlockTime: string;
  description: string;
  severity: string;
  affectedComponent: string;
  recommendation: string;
  createdBy?: string;
}

export interface UpdateVulnerabilityInput {
  name?: string;
  riskLevel?: string;
  status?: string;
  description?: string;
  severity?: string;
  affectedComponent?: string;
  recommendation?: string;
  expectedBlockTime?: string;
  updatedAt?: string;
}

// 数据库表创建SQL
export const CREATE_VULNERABILITIES_TABLE = `
  CREATE TABLE IF NOT EXISTS vulnerabilities (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    source VARCHAR(50) NOT NULL,
    risk_level ENUM('critical', 'high', 'medium', 'low') NOT NULL,
    discovery_time DATETIME NOT NULL,
    expected_block_time DATETIME,
    status ENUM('pending', 'processing', 'approved', 'unassigned') DEFAULT 'pending',
    description TEXT,
    severity VARCHAR(20) NOT NULL,
    affected_component VARCHAR(255),
    recommendation TEXT,
    approval_id VARCHAR(50),
    created_by VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_approval_id (approval_id),
    INDEX idx_risk_level (risk_level),
    INDEX idx_status (status),
    INDEX idx_discovery_time (discovery_time)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
`;

// 插入初始数据SQL
export const INSERT_INITIAL_VULNERABILITIES = `
  INSERT INTO vulnerabilities (
    id, name, source, risk_level, discovery_time, expected_block_time,
    status, description, severity, affected_component, recommendation,
    approval_id, created_by
  ) VALUES
    ('VUL-2024-001', 'SQL注入漏洞', 'IAST', '2024-01-15 10:30:00', '2024-01-20 00:00:00',
    'approved', '在用户登录模块发现SQL注入漏洞，攻击者可以通过构造恶意SQL语句获取数据库敏感信息', '严重', 'user/login',
    '立即使用参数化查询替换字符串拼接，对所有用户输入进行严格验证', NULL, 'system'),

    ('VUL-2024-002', 'XSS跨站脚本攻击', 'DAST', '2024-01-16 14:20:00', '2024-01-22 00:00:00',
    'approved', '在评论功能中发现存储型XSS漏洞，攻击者可以注入恶意脚本执行', '高危', 'product/comments',
    '对用户输入进行HTML编码，使用CSP头部保护', NULL, 'system'),

    ('VUL-2024-003', '敏感信息泄露', 'SCA', '2024-01-17 09:15:00', '2024-01-25 00:00:00',
    'approved', 'API接口返回包含用户密码哈希等敏感信息', '中危', 'api/user/profile',
    '移除敏感信息字段，仅返回必要的用户信息', NULL, 'system'),

    ('VUL-2024-004', 'CSRF跨站请求伪造', 'IAST', '2024-01-18 16:45:00', '2024-01-26 00:00:00',
    'approved', '关键业务操作缺少CSRF保护，可能导致恶意操作', '中危', 'user/settings',
    '添加CSRF令牌验证，使用SameSite Cookie', NULL, 'system'),

    ('VUL-2024-005', '文件上传漏洞', 'DAST', '2024-01-19 11:00:00', '2024-01-27 00:00:00',
    'pending', '文件上传功能存在类型绕过，可能导致恶意文件上传', '高危', 'file/upload',
    '严格验证文件类型，使用安全的文件存储策略', NULL, 'system'),

    ('VUL-2024-006', '权限绕过', 'IAST', '2024-01-20 15:30:00', '2024-01-28 00:00:00',
    'pending', '管理后台存在权限验证缺陷，普通用户可访问管理员功能', '严重', 'admin/panel',
    '实施严格的权限检查，使用基于角色的访问控制', NULL, 'system');
`;